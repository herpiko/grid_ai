<div>
        <h4 id="title" >Grid AI</h4>
        <h4 id="guide">Klik koordinat untuk membuat tembok <button id="tembokselesai">Selesai</button></h4>    
            <div style="display:none" id="kontrol">
                    <h4>Masukkan variabel koordinat lokasi</h4>
                        <input type="text" id="robot"><button id="pasang_robot" onclick="pasang_robot($('#robot').val())">Pasang robot</button>
                        <br>
                        <input type="text" id="target"><button id="pasang_target" onclick="pasang_target($('#target').val())">Pasang target</button>
                
            <h4>Jalankan</h4>
            <button onclick="bfs_loop()">Find a way in BFS mode</button>
            <button onclick="bfs_step()" disabled>BFS step</button>
            <button onclick="" disabled>DFS mode</button>
            <button onclick="" disabled>A* mode</button>
</div>
    <div id="container">
    </div>
    <p>
    
    <div style="display:none" id="muatulang">
          <a href="">Muat ulang laman</a>

    </div>
                    <button id="bangun_grid_" onclick="bangun_grid()">Bangun grid</button>
                    <button id="bangun_tembok_" style="display:none" onclick="bangun_tembok()">Bangun tembok</button>
                </div>
<script src="./jquery.min.js">
</script>
<script>
"use strict"
var robot;
var target;
var tembok=[];
var sudah=[];
var looping;
var pohon=[];
//step

    var antrian=[];
    var pernah=[];
    var antrian_id=1;
    var loc;
    var y;
    var x;
    var q=0;
    var langkah=1;
    var ceksudah;
    var ceksudahflag=false;
    var sudahpernah=false;
function path(){
var path=[];
var zz;
var yy;
var bb;
var xx=target;;
var aa = pohon.length-1;
    for(bb=(aa);bb>0;bb--){
        if(pohon[bb].anak==xx){
            xx=pohon[bb].ortu;
            path.push(xx);
        
        }
    }
    for(yy=0;yy<path.length;yy++){
        $('#'+path[yy]).removeClass('yellow');
        $('#'+path[yy]).addClass('white');
    }
    console.log('pohon : '+JSON.stringify(pohon));
    console.log('path : '+path);
    $('#guide').html('Done! '+(langkah)+' langkah pencarian dalam BFS, '+(path.length)+' langkah solusi tercepat.');
}
function bfs_step(){
    breakpoint : if(parseInt(loc)==parseInt(target)){
    } else {
    
    
    $('#guide').html('Processing...');
    $('#muatulang').show();
    antrian_id=parseInt(antrian_id)+1;
    //perulangan
    console.log("step for loc "+loc+" #########################"); 
    //for(q=0;q<30;q++){
    console.log('tembok : '+tembok);
    if(!istembok(loc)){
        console.log('ambil nilai  untuk sekililingnya '+loc);
        tembok.push(parseInt(loc));
        
        // atas
        loc = parseInt(loc);
        y = loc-20;
        if(!istembok(y)){
            console.log('cek atas');
            var tem;
            sudahpernah=false;
            for(tem=0;tem<pernah.length;tem++){
                if(parseInt(pernah[tem])==parseInt(y)){
                    sudahpernah=true;
                }
            }
            if(!sudahpernah){
                console.log(y+' belum pernah, masukin ke array')
                $('#'+y).addClass('green');
                antrian.push({id:antrian_id,loc:y});
                console.log(JSON.stringify(antrian));
                antrian_id=parseInt(antrian_id)+1;
                pernah.push(parseInt(y));
                //bikin pohon
                pohon.push({ortu:loc,anak:y});
                //if target
                if(y==target){
                    clearInterval(looping);
                    $('#'+y).removeClass('green');
                    path();
                    alert('Target udah ketemu!');
                    break breakpoint;
                }
            } else {
                console.log('sudah pernah, skip')
            }
        }
        // kiri
        loc = parseInt(loc);
        y = loc-1;
        if(!istembok(y)){
            console.log('cek kiri');
            var tem;
            sudahpernah=false;
            for(tem=0;tem<pernah.length;tem++){
                if(parseInt(pernah[tem])==parseInt(y)){
                    sudahpernah=true;
                }
            }
            if(!sudahpernah){
                console.log(y+' belum pernah, masukin ke array')
                $('#'+y).addClass('green');
                antrian.push({id:antrian_id,loc:y});
                console.log(JSON.stringify(antrian));
                antrian_id=parseInt(antrian_id)+1;
                pernah.push(parseInt(y));
                //bikin pohon
                pohon.push({ortu:loc,anak:y});
                //if target
                if(y==target){
                    clearInterval(looping);
                    $('#'+y).removeClass('green');
                    path();
                    alert('Target udah ketemu!');
                    break breakpoint;
                }
            } else {
                console.log('sudah pernah, skip')
            }
        }
        // bawah
        loc = parseInt(loc);
        y = loc+20;
        if(!istembok(y)){
            console.log('cek bawah');
            var tem;
            sudahpernah=false;
            for(tem=0;tem<pernah.length;tem++){
                if(parseInt(pernah[tem])==parseInt(y)){
                    sudahpernah=true;
                }
            }
            if(!sudahpernah){
                console.log(y+' belum pernah, masukin ke array')
                $('#'+y).addClass('green');
                antrian.push({id:antrian_id,loc:y});
                console.log(JSON.stringify(antrian));
                antrian_id=parseInt(antrian_id)+1;
                pernah.push(parseInt(y));
                //bikin pohon
                pohon.push({ortu:loc,anak:y});
                //if target
                if(y==target){
                    clearInterval(looping);
                    $('#'+y).removeClass('green');
                    path();
                    alert('Target udah ketemu!');
                    break breakpoint;
                }
            } else {
                console.log('sudah pernah, skip')
            }
        }
        // kanan
        loc = parseInt(loc);
        y = loc+1;
        if(!istembok(y)){
            console.log('cek kanan');
            var tem;
            sudahpernah=false;
            for(tem=0;tem<pernah.length;tem++){
                if(parseInt(pernah[tem])==parseInt(y)){
                    sudahpernah=true;
                }
            }
            if(!sudahpernah){
                console.log(y+' belum pernah, masukin ke array')
                $('#'+y).addClass('green');
                antrian.push({id:antrian_id,loc:y});
                console.log(JSON.stringify(antrian));
                antrian_id=parseInt(antrian_id)+1;
                pernah.push(parseInt(y));
                //bikin pohon
                pohon.push({ortu:loc,anak:y});
                //if target
                if(y==target){
                    clearInterval(looping);
                    $('#'+y).removeClass('green');
                    path();
                    alert('Target udah ketemu!');
                    break breakpoint;
                }
            } else {
                console.log('sudah pernah, skip')
            }
        }
        
        
        // selesai ambil sekeliling
        console.log('langkah ke '+langkah );
        if(ceksudahflag){
            q++;
            ceksudahflag=false;
        }
        
        console.log(JSON.stringify(antrian));
        q=parseInt(q);
        console.log(q);
        loc = antrian[q].loc;
        console.log('cek nilai '+loc);
        var tem;
        for(tem=0;tem<tembok.length;tem++){
            //console.log('cek tembok '+tembok[tem]);
                if(parseInt(tembok[tem])==parseInt(loc)){
                
                ceksudah = true;
            }
        }
        if(ceksudah){
            loc = parseInt(antrian[q].loc)
            console.log(JSON.stringify(antrian));
            console.log('nilai '+loc+' sudah dipakai');
            console.log(antrian_id);
            loc = '';
            //var r = q+1;
            loc = parseInt(antrian[q].loc)
            console.log('nilai yang diambil '+loc);
            ceksudahflag=true;
            console.log('kuningkan '+loc);
            $('#'+loc).html('<strong>'+langkah+'</strong>');
            $('#'+loc).addClass('yellow');
            $('#'+loc).removeClass('green');
            console.log('langkah : '+langkah+' untuk lokasi '+loc);
            var loc_ = parseInt(antrian[q].loc)
            console.log(JSON.stringify(antrian));
            console.log('nilai '+loc_+' belum dipakai');
            console.log('nilai yang diambil '+loc_);
            console.log(antrian_id);
            console.log('langkah selanjutnya : '+langkah+' untuk lokasi '+loc_);
            langkah++
        } else {
            console.log('kuningkan '+loc);
            $('#'+loc).html('<strong>'+langkah+'</strong>');
            $('#'+loc).addClass('yellow');
            $('#'+loc).removeClass('green');
            var loc_ = parseInt(antrian[q].loc)
            console.log(JSON.stringify(antrian));
            console.log('nilai '+loc_+' belum dipakai');
            console.log('nilai yang diambil '+loc_);
            console.log(antrian_id);
            console.log('langkah selanjutnya : '+langkah+' untuk lokasi '+loc_);
            langkah++
        
        console.log('tambahkan ke tembok : '+tembok);
        }
    } else {
    
        console.log("sudah ada di tembok"); 
    } 
    console.log("end of step #########################");
   q++; 
    
        
    }
}

function bfs_loop(){
    $('#kontrol').hide();
    looping = setInterval(function(){
        bfs_step();
    },50);
}


function bangun_grid(){
    var x = 1;
    var y = 20;
    var z = 20;
    var id = 1
    while(x<=y){
            $('#container').append('<div style="">');
        while(id<=z){
            $('#container').append('<div class=\"grid tembokable\" id=\"'+id+'\">'+id+'</div>');
            id=id+1;
        }
        z=z+y
        $('#container').append('</div>');
        x=x+1;
    }
    $('#bangun_grid_').hide();
    $('#bangun_tembok_').show();
}   

function tambah_tembok(id){
        tembok.push(id);
        $('#'+id).addClass('black');
    }
function bangun_tembok(){
    var id;
    // tembok atas
    id=1;
    while(id<=20){
        tembok.push(id);
        $('#'+id).addClass('black');
        id++;
    }
    // tembok kiri
    id=21;
    while(id<=381){
        tembok.push(id);
        $('#'+id).addClass('black');
        id=id+20;
    }
    // tembok bawah
    id=382;
    while(id<=399){
        tembok.push(id);
        $('#'+id).addClass('black');
        id++;
    }
    // tembok kanan
    id=40
    while(id<=400){
        tembok.push(id);
        $('#'+id).addClass('black');
        id=id+20;
    }
    $('#bangun_tembok_').hide();
}

function istembok(id){
        var i;
    for(i=0;i<400; i++){
        if(id==tembok[i]){
            return true;
        }
    }
}
function pasang_robot(id){
    loc = id;
    pernah=[];
    pernah=[id];
    console.log('robot');
    if(id>=0 && id<=400){    
        if(!istembok(id)){
            $('#'+robot).removeClass('blue');
            $('#'+id).addClass('blue');
            robot = id;
            var id_current = robot;
        } else {
            alert('Jangan pasang di tembok!');
        }
    } else {
        alert('Pasang lokasi yang benar! (1-400)');
    }
}
function pasang_target(id){
    if(id>=0 && id<=400){    
        if(!istembok(id)){       
            $('#'+target).removeClass('red');
            $('#'+id).addClass('red');
            target = id;
        } else {
            alert('Jangan pasang di tembok!');
        }
    } else {
        alert('Pasang lokasi yang benar! (1-400)');
    }
}

//fungsi gerak
function derajat0(){
    id_now = id_current-1;
    $('#'+id_now).addClass('yellow');
    id_current = id_now; 
}
function derajat90(){
    id_now = id_current-20;
    $('#'+id_now).addClass('yellow');
    id_current = id_now; 
}
function derajat180(){
    id_now = id_current+1;
    $('#'+id_now).addClass('yellow');
    id_current = id_now; 
}
function derajat270(){
    id_now = id_current+20;
    $('#'+id_now).addClass('yellow');
    id_current = id_now; 
}
$(document).ready(function () {
    bangun_grid();
    bangun_tembok();
    var tembokable=true;
    $('.tembokable').click(function(){
            if(tembokable){
            tambah_tembok(parseInt(($(this).text())));
            }
            });

    $('#tembokselesai').click(function(){
            tembokable=false;
            $('#guide').html('Pasang robot dan target');
            $('#kontrol').show();
            });    
});
</script>
<style>
.button_grid{
    display:inline-block;
    margin:1px;
}
.grid{
    display:inline-block;
    background-color:#cec8c8;
    margin:1px;
    width:20px;
    height:20px;
    font-size:10px;
    color:#969696;
    cursor:pointer;
}

.white{
    background-color:white;
}
.yellow{
    background-color:yellow;
}
.red{
    background-color:red;
}
.blue{
    background-color:blue;
}
.black{
    background-color:black;
}
.green{
    background-color:green;
}
</style>
